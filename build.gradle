plugins {
    id("com.github.johnrengelman.shadow") version "6.1.0"
    id("io.micronaut.application") version "1.4.2"
}

version = "0.1"
group = "codes.recursive"

repositories {
    mavenCentral()
    mavenLocal()
    maven { url "https://s01.oss.sonatype.org/content/repositories/snapshots/" }
}

micronaut {
    runtime("netty")
    testRuntime("junit5")
    processing {
        incremental(true)
        annotations("codes.recursive.*")
    }
}

dependencies {
    annotationProcessor("io.micronaut.data:micronaut-data-processor")
    annotationProcessor("io.micronaut:micronaut-http")
    implementation("io.micronaut:micronaut-validation")
    implementation("io.micronaut:micronaut-runtime")
    implementation("javax.annotation:javax.annotation-api")
    implementation("io.micronaut:micronaut-http-client")
    implementation("io.micronaut.sql:micronaut-jdbc-hikari")
    implementation("io.micronaut.data:micronaut-data-hibernate-jpa")
    implementation("io.micronaut.mqtt:micronaut-mqttv3")
    implementation("io.micronaut.views:micronaut-views-thymeleaf")
    runtimeOnly("ch.qos.logback:logback-classic")
    implementation("io.micronaut.oraclecloud:micronaut-oraclecloud-sdk:1.2.1")
    implementation(enforcedPlatform("com.oracle.database.jdbc:ojdbc-bom:21.1.0.0"))
    implementation("com.oracle.database.jdbc:ojdbc8")
    runtime("io.micronaut.oraclecloud:micronaut-oraclecloud-atp:1.2.1")
}

application {
    mainClass.set("codes.recursive.Application")
}

java {
    sourceCompatibility = JavaVersion.toVersion("11")
    targetCompatibility = JavaVersion.toVersion("11")
}

tasks.withType(JavaExec) {
    classpath += configurations.developmentOnly
    systemProperties += System.properties
    jvmArgs('-XX:TieredStopAtLevel=1', '-Dcom.sun.management.jmxremote')
    if (gradle.startParameter.continuous) {
        systemProperties(
                'micronaut.io.watch.restart':'true',
                'micronaut.io.watch.enabled':'true',
                "micronaut.io.watch.paths":"src/main"
        )
    }
}

nativeImage {
    args('--initialize-at-run-time=codes.recursive.domain.ReadingOverallAverageDTO --initialize-at-run-time=codes.recursive.domain.Reading --initialize-at-runtime=codes.recursive.domain.ReadingByDayNightDTO --initialize-at-runtime=codes.recursive.domain.ReadingByDayOfMonthDTO --initialize-at-runtime=codes.recursive.domain.ReadingByHourDTO')
}

